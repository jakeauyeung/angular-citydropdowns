"use strict";var dd=angular.module("ngCityDropdowns",[]);dd.directive("cityDropdownSelect",["DropdownServiceCity","$window",function(e,n){return{restrict:"A",replace:!0,scope:{cityDropdownSelect:"=",dropdownModel:"=",dropdownOnchange:"&"},controller:["$scope","$element","$attrs",function(n,o,c){n.labelField=c.dropdownItemLabel||"text",n.countField=c.dropdownItemCount||"text",e.register(o),this.select=function(e,o,c){e={name:e.name,deal_count:e.deal_count,circle:{name:o,deal_count:c},choose:{name:o},distance:{name:""}},e!==n.dropdownModel&&angular.copy(e,n.dropdownModel),n.dropdownOnchange({selected:e})},this.removeClick=function(){$(o[0]).removeClass("active")},n.circleAll=function(){var e={name:"",deal_count:"",circle:{name:"全部商区",deal_count:""},choose:{name:"全部商区"},distance:{name:""}};e!==n.dropdownModel&&angular.copy(e,n.dropdownModel),n.dropdownOnchange({selected:e}),$(o[0]).removeClass("active")};var t=function(e){var c,t=window.sessionStorage.getItem("cityChangeSelectData");t?(t=JSON.parse(t),c={name:t.name,circle:{name:t.circle.name},choose:{name:e},distance:{name:e}}):c={name:"",deal_count:"",circle:{name:"",deal_count:""},choose:{name:e},distance:{name:e}},c!==n.dropdownModel&&angular.copy(c,n.dropdownModel),n.dropdownOnchange({selected:c}),$(o[0]).removeClass("active"),$(".nore").removeClass("cur")};n.selectItemSprice=function(e){switch(e){case"不限距离":t(e);break;case"500米":t(e);break;case"1000米":t(e);break;case"2000米":t(e);break;case"5000米":t(e)}},n.selectCircleSprice=function(){$(".sub-right").hide(),$(".district-list").removeClass("cur"),$(".all-dist").removeClass("cur"),$(".nore").addClass("cur").find(".sub-right").show()},n.disList=[{dis:"不限距离"},{dis:"500米"},{dis:"1000米"},{dis:"2000米"},{dis:"5000米"}];var d="click";o.bind(d,function(c){c.stopPropagation(),e.toggleActiveCity(o,n.dropdownModel.name,n.dropdownModel.circle.name,n.dropdownModel.choose.name)}),n.$on("$destroy",function(){e.unregister(o)})}],template:['<div class="wrap-dd-select-city">','<div class="nav-mask"></div>','<span class="selected"><span class="selected-item">{{dropdownModel.choose[labelField]}}</span><i class="sarrow"></i>','<div class="dropdown">','<div class="left">',"<ul>",'<li class="district-list nore">','<a ng-click="selectCircleSprice()" class="dropdown-item"><i class="drop-list-text">附近</i></a>','<div class="sub-right">','<a ng-click="selectItemSprice(distance.dis)" ng-repeat="distance in disList"><b>{{distance.dis}}</b><span class="check icon-check"></span></a>',"</div>","</li>",'<li class="all-dist"><a ng-click="circleAll()">全部商区</a></li>','<li ng-repeat="item in cityDropdownSelect"','dropdown-select-city="item"','dropdown-item-count="countField"','dropdown-item-label="labelField">',"</li>","</ul>","</div>",'<div class="right">',"</div>","</div>","</div>"].join("")}}]),dd.directive("dropdownSelectCity",[function(){return{require:"^cityDropdownSelect",replace:!0,scope:{dropdownItemLabel:"=",dropdownItemCount:"=",dropdownSelectCity:"="},link:function(e,n,o,c){e.selectItem=function(n,o){e.dropdownSelectCity.href||(c.select(e.dropdownSelectCity,n,o),c.removeClick())},e.selectCircle=function(){$(".sub-right").hide(),$(".district-list").removeClass("cur"),$(".all-dist").removeClass("cur"),$(n[0]).addClass("cur"),$(n.children()[1]).show()}},template:['<li class="district-list" >','<a href="" class="dropdown-item"',' ng-if="dropdownSelectCity.name"',' ng-href="{{dropdownSelectCity.href}}"',' ng-click="selectCircle()">','<i class="drop-list-text">{{dropdownSelectCity[dropdownItemLabel]}}</i>','<span class="num">{{dropdownSelectCity[dropdownItemCount]}}</span>',"</a>",'<div class="sub-right" ng-if="dropdownSelectCity.name">','<a ng-click="selectItem(dropdownSelectCity[dropdownItemLabel])">全部<b>{{dropdownSelectCity[dropdownItemLabel]}}</b><span class="check icon-check"></span><span class="num">{{dropdownSelectCity[dropdownItemCount]}}</span></a>','<a ng-repeat="cirle in dropdownSelectCity.circle"','ng-click="selectItem(cirle.name, cirle.deal_count)">',"<b>{{cirle.name}}</b>",'<span class="check icon-check"></span>','<span class="num">{{cirle.deal_count}}</span>',"</a>","</div>","</li>"].join("")}}]),dd.directive("dropdownSelectCircle",[function(){return{require:"^cityDropdownSelect",replace:!0,scope:{dropdownCircleLabel:"=",dropdownCircleCount:"=",dropdownSelectCircle:"="},link:function(e,n,o,c){e.selectItem=function(){e.dropdownSelectCircle.href||c.select(e.dropdownSelectCircle)}},template:["<li>",'<a href="" class="dropdown-item"',' ng-href="{{dropdownSelectCircle.href}}"',' ng-click="selectItem()">','<i class="drop-list-text">{{dropdownSelectCircle[dropdownCircleLabel]}}</i>','<span class="check icon-check"></span>','<span class="num">{{dropdownSelectCircle[dropdownCircleCount]}}</span>',"</a>","</li>"].join("")}}]),dd.directive("dropdownMenu",["$parse","$compile","DropdownServiceCity","$window",function(e,n,o,c){return{restrict:"A",replace:!1,scope:{dropdownMenu:"=",dropdownModel:"=",dropdownOnchange:"&"},controller:["$scope","$element","$attrs",function(e,c,t){e.labelField=t.dropdownItemLabel||"text",e.countField=t.dropdownItemCount||"text";var d="click",i=angular.element(['<ul class="dropdown">','<li ng-repeat="item in dropdownMenu"',' class="dropdown-item"',' dropdown-item-label="labelField"',' dropdown-item-count="countField"',' dropdown-menu-item="item">',"</li>","</ul>"].join(""));i.data("$dropdownMenuController",this);var r=n(i)(e),l=angular.element('<div class="wrap-dd-menu"></div>');c.replaceWith(l),l.append(c),l.append(r),o.register(r),this.select=function(n){n!==e.dropdownModel&&angular.copy(n,e.dropdownModel),e.dropdownOnchange({selected:n})},c.bind(d,function(e){e.stopPropagation(),o.toggleActiveCity(r)}),e.$on("$destroy",function(){o.unregister(r)})}]}}]),dd.directive("dropdownMenuItem",[function(){return{require:"^dropdownMenu",replace:!0,scope:{dropdownMenuItem:"=",dropdownItemLabel:"=",dropdownItemCount:"="},link:function(e,n,o,c){e.selectItem=function(){e.dropdownMenuItem.href||c.select(e.dropdownMenuItem)}},template:["<li>",'<a href="" class="dropdown-item"',' ng-click="selectItem()">',"{{dropdownMenuItem[dropdownItemLabel]}}","</a>","</li>"].join("")}}]),dd.factory("DropdownServiceCity",["$document",function(e){var n=e.find("body"),o={},c=[];return n.bind("click",function(){angular.forEach(c,function(e){e.removeClass("active")})}),o.register=function(e){c.push(e)},o.unregister=function(e){var n;n=c.indexOf(e),n>-1&&c.splice(n,1)},o.toggleActiveCity=function(e,n,o,t){$(".wrap-dd-select").removeClass("active"),angular.forEach(c,function(n){n!==e&&n.removeClass("active")});var d=e.find("i"),i=e.find("b");"全部商区"===o&&$(".all-dist").addClass("cur"),angular.forEach(d,function(e){var o=$(e).text();n===o?$(e).parents("li").addClass("cur"):$(e).parents("li").removeClass("cur")}),angular.forEach(i,function(e){var n=$(e).text();o===n||t===n?($(e).parents("a").addClass("current"),$(e).parents(".sub-right").show()):$(e).parents("a").removeClass("current")});var r=function(){$(".all-dist").removeClass("cur"),$(".district-list").removeClass("cur"),$(".nore").addClass("cur")};switch(t){case"不限距离":r();break;case"500米":r();break;case"1000米":r();break;case"2000米":r();break;case"5000米":r()}e.find("a").bind("click",function(e){e.stopPropagation()}),e.toggleClass("active")},o}]);